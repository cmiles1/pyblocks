import{T as e,d as t,a as r,o as n,X as o,H as s,s as i}from"./core-BQAbLvre.js";let a=0;const c=e=>`${e}-editor-${a++}`,l=new Map,u=new Map,d={worker:{codeBeforeRun:()=>i,onReady:({runAsync:e,io:t},{sync:r})=>{t.stdout=t.buffered(r.write),t.stderr=t.buffered(r.writeErr),r.revoke(),r.runAsync=e}}};async function p({currentTarget:e}){const{env:t,pySrc:r,outDiv:i}=this,a=!!e;if(a&&(e.disabled=!0,i.innerHTML=""),!l.has(t)){const e=URL.createObjectURL(new Blob([""])),r={type:this.interpreter},{config:i}=this;if(i){r.configURL=i;const{parse:e}=i.endsWith(".toml")?await import("./toml-CvAfdf9_.js"):JSON;r.config=e(await fetch(i).then((e=>e.text()))),r.version=n(r.config)}else r.config={};const a=o.call(new s(null,d),e,r),{sync:c}=a,{promise:u,resolve:p}=Promise.withResolvers();l.set(t,u),c.revoke=()=>{URL.revokeObjectURL(e),p(a)}}return l.get(t).then((t=>{t.onerror=({error:e})=>{a&&(i.innerHTML+=`<span style='color:red'>${e.message||e}</span>\n`),console.error(e)};const n=()=>{a&&(e.disabled=!1)},{sync:o}=t;o.write=e=>{a&&(i.innerText+=`${e}\n`)},o.writeErr=e=>{a&&(i.innerHTML+=`<span style='color:red'>${e}</span>\n`)},o.runAsync(r).then(n,n)}))}const m=(e,t)=>{const r=document.createElement("div");r.className=`${t}-editor-input`,r.setAttribute("aria-label","Python Script Area");const n=((e,t)=>{const r=document.createElement("button");return r.className=`absolute ${t}-editor-run-button`,r.innerHTML='<svg style="height:20px;width:20px;vertical-align:-.125em;transform-origin:center;overflow:visible;color:green" viewBox="0 0 384 512" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg"><g transform="translate(192 256)" transform-origin="96 0"><g transform="translate(0,0) scale(1,1)"><path d="M361 215C375.3 223.8 384 239.3 384 256C384 272.7 375.3 288.2 361 296.1L73.03 472.1C58.21 482 39.66 482.4 24.52 473.9C9.377 465.4 0 449.4 0 432V80C0 62.64 9.377 46.63 24.52 38.13C39.66 29.64 58.21 29.99 73.03 39.04L361 215z" fill="currentColor" transform="translate(-192 -256)"></path></g></g></svg>',r.setAttribute("aria-label","Python Script Run Button"),r.addEventListener("click",(async t=>{r.blur(),await e.handleEvent(t)})),r})(e,t),o=document.createElement("div");return o.addEventListener("keydown",(e=>{e.stopPropagation()})),r.append(n,o),r},f=(e,t)=>{const r=document.createElement("div");r.className=`${t}-editor-box`;const n=m(e,t),o=(e=>{const t=document.createElement("div");return t.className=`${e}-editor-output`,t.id=`${c(e)}-output`,t})(t);return r.append(n,o),[r,o,n.querySelector("button")]},h=async(e,n,o)=>{const[{basicSetup:s,EditorView:i},{Compartment:a},{python:l},{indentUnit:d},{keymap:m},{defaultKeymap:h,indentWithTab:g}]=await Promise.all([import("./codemirror-kHGMDdMq.js"),import("./codemirror_state-D1qTXrff.js"),import("./codemirror_lang-python-PBvh5MWJ.js"),import("./codemirror_language-C0ccoJVB.js").then((function(e){return e.x})),import("./codemirror_view-CvBNngGG.js").then((function(e){return e.q})),import("./codemirror_commands-BNzatDRz.js")]);let v=e.hasAttribute("setup");const y=e.hasAttribute("config"),b=`${o}-${e.getAttribute("env")||c(n)}`;if(y&&u.has(b))throw new SyntaxError(u.get(b)?`duplicated config for env: ${b}`:`unable to add a config to the env: ${b}`);u.set(b,y);let w=e.src?await fetch(e.src).then((e=>e.text())):e.textContent;const E={handleEvent:p,interpreter:o,env:b,config:y&&new URL(e.getAttribute("config"),location.href).href,get pySrc(){return v?w:j.state.doc.toString()},get outDiv(){return v?null:S}};let $;t(e,{target:{get:()=>$},handleEvent:{get:()=>E.handleEvent,set:e=>{E.handleEvent=e===p?p:async r=>{const{currentTarget:n}=r;t(r,{code:{value:E.pySrc}}),!1!==await e(r)&&await p.call(E,{currentTarget:n})}}},code:{get:()=>E.pySrc,set:e=>{v||j.update([j.state.update({changes:{from:0,to:j.state.doc.length,insert:e}})])}},process:{value(e){const t=v,r=w;v=!0,w=e;const n=()=>{v=t,w=r};return E.handleEvent({currentTarget:null}).then(n,n)}}});const x=()=>{const t=new Event(`${n}-editor`,{bubbles:!0});e.dispatchEvent(t)};if(v)return await E.handleEvent({currentTarget:null}),void x();const A=e.getAttribute("target");if(A){if($=document.getElementById(A)||document.querySelector(A),!$)throw new Error(`Unknown target ${A}`)}else $=document.createElement(`${n}-editor`),$.style.display="block",e.after($);$.id||($.id=c(n)),$.hasAttribute("exec-id")||$.setAttribute("exec-id",0),$.hasAttribute("root")||$.setAttribute("root",$.id);const[L,S,C]=f(E,n);L.dataset.env=e.hasAttribute("env")?b:o;const T=L.querySelector(`.${n}-editor-input > div`).attachShadow({mode:"open"});T.innerHTML="<style> :host { all: initial; }</style>",$.appendChild(L);const k=r(e.textContent).trim(),M=/^([ \t]+)/m.test(k)?RegExp.$1:"    ",R=()=>C.click(),j=new i({extensions:[d.of(M),(new a).of(l()),m.of([...h,{key:"Ctrl-Enter",run:R,preventDefault:!0},{key:"Cmd-Enter",run:R,preventDefault:!0},{key:"Shift-Enter",run:R,preventDefault:!0},g]),s],foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],parent:T,doc:k});j.focus(),x()};let g=0,v=Promise.resolve();const y=()=>{g=0,b()},b=()=>{if(!g){g=setTimeout(y,250);for(const[t,r]of e){const e=`script[type="${t}-editor"]`;for(const n of document.querySelectorAll(e))n.type+="-active",v=v.then((()=>h(n,t,r)))}return v}};new MutationObserver(b).observe(document,{childList:!0,subtree:!0});var w=b();export{w as default};
//# sourceMappingURL=py-editor-D3FDoYNU.js.map
